openapi: 3.0.3
info:
  title: Rabo Smart Pay Merchant Webhooks Endpoint
  version: 0.0.1
tags:
  - name: Webhooks
servers:
  - description: local
    url: https://localhost:8080
paths:
  "/webhook":
    post:
      tags: [ Webhooks ]
      operationId: acceptWebhook
      summary: Receive Rabo Smart Pay webhooks.
      description: Receive Rabo Smart Pay webhooks.
      parameters:
        - in: header
          name: "x-smartpay-signature"
          description: |
            Cryptograhic signature of the event, generated by Rabo Smart Pay.
            <br><br>
            See
            [the documentation on verifying signatures](https://www.rabo.dev/docs/developer-tools/webhooks/accepting-events/verifying-signatures)
            for more information on how to verify this signature.
          required: true
          schema:
            type: string
            format: jws
        - in: header
          name: "x-smartpay-event-type"
          required: true
          schema:
            type: string
          example: "order.status.finalized/v1"
        - in: header
          name: "x-smartpay-event-id"
          required: true
          schema:
            type: string
          example: "evt_74M44LGTN7Q7TW7R3LFNQ"
      requestBody:
        required: true
        content:
          application/rabo-smartpay-webhook-v3+json:
            schema:
              $ref: "#/components/schemas/WebhookDeliveryRequest"

      responses:
        "200":
          description: |
            Your server understood the request, and acknowledges that it has
            processed, or persisted the data therein.
            <br><br>
            See
            [the documentation on acknowledging events](https://www.rabo.dev/docs/developer-tools/webhooks/accepting-events/acknowledging-events)
            for more information.

          content:
            text/plain:
              schema:
                type: string
                example: ok
                enum:
                  - "ack"
        "500":
          description: |
            Your server was not able to process the request at this time. Rabo
            Smart Pay will retry the webhook request at a later point in time.
            <br><br>
            See
            [the documentation on retrying failed deliveries](https://www.rabo.dev/docs/developer-tools/webhooks/accepting-events/retrying-failed-deliveries)
            for more information.

components:
  schemas:
    WebhookDeliveryRequest:
      type: object
      required:
        - id
        - type
        - subscription
        - data
        - timestamp
      properties:
        id:
          description: |
            Identifier of this event.

            You can use this identifier as an idempotency key on your
            side to check if you have already this webhook before or
            not.
            
            In case of retried deliveries, Rabo Smart Pay will re-use
            this identifier.
            
            See
            [the documentation on event idempotency](https://www.rabo.dev/docs/developer-tools/webhooks/accepting-events/event-idempotency)
            for more information.
          type: string
          example: "evt_74M44LGTN7Q7TW7R3LFNQ"
        type:
          type: string
          example: "order.status.finalized/v1"
        subscription:
          type: object
          required:
            - id
          properties:
            id:
              type: string
              example: "wsb_72RYA4TFYFKLDXGBWARDX"
            description:
              type: string
              example: "My webhook subscription"
        data:
          type: object
          additionalProperties: true
          example:
            orderId: "ae918f42-ed83-4af7-b831-20b46d9d1dfc"
            status: "completed"
            amount:
              total: 1337,
              paid: 1337
            metadata: "...merchant-defined-metadata..."
        timestamp:
          description: Unix timestamp
          type: integer
          format: int64
          example: 1725290562